<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sakura Quest</title>
    <!-- T·∫£i c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // To√†n b·ªô m√£ ngu·ªìn React c·ªßa ·ª©ng d·ª•ng s·∫Ω n·∫±m ·ªü ƒë√¢y.

        // --- D·ªÆ LI·ªÜU GI·∫¢ L·∫¨P FIREBASE (CHO TO√ÄN B·ªò ·ª®NG D·ª§NG) ---
        const MOCK_MILESTONES = [
            { id: 'n5-01', level: 'N5', order: 1, title: 'B√†i 1: B·∫£ng ch·ªØ c√°i', description: 'H·ªçc Hiragana & Katakana.', xpReward: 50, sakuraPointReward: 5, vocabulary: [{ word: "„ÅÇ", reading: "a", meaning: "Ch·ªØ A" }], quiz: [{ question: "'„ÅÇ' ƒë·ªçc l√† g√¨?", options: ["a", "i", "u"], answer: "a" }] },
            { id: 'n5-02', level: 'N5', order: 2, title: 'B√†i 2: Ch√†o h·ªèi & Gi·ªõi thi·ªáu', description: 'Nh·ªØng m·∫´u c√¢u giao ti·∫øp ƒë·∫ßu ti√™n.', xpReward: 50, sakuraPointReward: 5, vocabulary: [{ word: "„Åì„Çì„Å´„Å°„ÅØ", reading: "konnichiwa", meaning: "Xin ch√†o" }], quiz: [{ question: "'Xin ch√†o' l√† g√¨?", options: ["Sayonara", "Konnichiwa", "Arigatou"], answer: "Konnichiwa" }] },
            { id: 'n5-03', level: 'N5', order: 3, title: 'B√†i 3: Mua s·∫Øm & H·ªèi gi√°', description: 'H·ªçc s·ªë ƒë·∫øm v√† c√°ch h·ªèi gi√° ti·ªÅn.', xpReward: 50, sakuraPointReward: 5, vocabulary: [{ word: "„ÅÑ„Åè„Çâ", reading: "ikura", meaning: "Bao nhi√™u ti·ªÅn" }], quiz: [{ question: "H·ªèi gi√° n√≥i th·∫ø n√†o?", options: ["Ikura desu ka", "Nani desu ka", "Doko desu ka"], answer: "Ikura desu ka" }] },
            { id: 'n4-01', level: 'N4', order: 4, title: 'B√†i 1 (N4): Th·ªÉ kh·∫£ nƒÉng', description: 'Di·ªÖn t·∫£ kh·∫£ nƒÉng l√†m g√¨ ƒë√≥.', xpReward: 75, sakuraPointReward: 10, vocabulary: [], quiz: [{ question: "Th·ªÉ kh·∫£ nƒÉng c·ªßa '„Åø„Åæ„Åô' l√† g√¨?", options: ["„Åø„Çâ„Çå„Åæ„Åô", "„Åø„Åï„Åõ„Åæ„Åô", "„Åø„Åæ„Åó„Åü"], answer: "„Åø„Çâ„Çå„Åæ„Åô" }] },
            { id: 'n4-02', level: 'N4', order: 5, title: 'B√†i 2 (N4): Th·ªÉ b·ªã ƒë·ªông', description: 'Di·ªÖn t·∫£ h√†nh ƒë·ªông b·ªã t√°c ƒë·ªông.', xpReward: 75, sakuraPointReward: 10, vocabulary: [], quiz: [] },
        ];
        const MOCK_USER_PROGRESS = {id: 'user123', displayName: "An-san", avatarUrl: 'https://placehold.co/40x40/FFB7C5/5a3838?text=A', xp: 250, sakuraPoints: 520, completedMilestones: ['n5-01', 'n5-02'], currentMilestoneId: 'n5-03', purchasedItems: ['theme_light'],};
        const MOCK_LEADERBOARD_DATA = [{ id: 'user001', displayName: 'Yuki', xp: 1500, avatarUrl: 'https://placehold.co/40x40/a2d2ff/ffffff?text=Y' }, { id: 'user002', displayName: 'Hiroshi', xp: 1250, avatarUrl: 'https://placehold.co/40x40/bde0fe/ffffff?text=H' }, { id: 'user003', displayName: 'Sakura', xp: 980, avatarUrl: 'https://placehold.co/40x40/ffafcc/ffffff?text=S' }, { id: 'user004', displayName: 'Kenji', xp: 750, avatarUrl: 'https://placehold.co/40x40/caffbf/ffffff?text=K' }, { id: 'user123', displayName: 'An-san', xp: 250, avatarUrl: 'https://placehold.co/40x40/FFB7C5/5a3838?text=A' }, { id: 'user005', displayName: 'Mai', xp: 120, avatarUrl: 'https://placehold.co/40x40/fdffb6/ffffff?text=M' },].sort((a, b) => b.xp - a.xp);
        const MOCK_SHOP_ITEMS = [{ id: 'theme_dark', name: 'Giao di·ªán Ban ƒë√™m', price: 500, type: 'theme', icon: 'üåô' }, { id: 'theme_sakura', name: 'Giao di·ªán Sakura', price: 750, type: 'theme', icon: 'üå∏' }, { id: 'avatar_frame_gold', name: 'Khung V√†ng', price: 1000, type: 'avatar_frame', icon: 'üåü' },];
        const MOCK_CULTURAL_CHALLENGE = {id: 'challenge_sushi', title: "Th·ª≠ th√°ch: Vua Sushi", description: "B·∫°n bi·∫øt bao nhi√™u v·ªÅ m√≥n ƒÉn qu·ªëc h·ªìn qu·ªëc t√∫y n√†y?", xpReward: 100, quiz: [{ question: "Lo·∫°i c√° n√†o th∆∞·ªùng d√πng cho m√≥n 'Maguro' sushi?", options: ["C√° h·ªìi", "C√° ng·ª´", "C√° tr√≠ch"], answer: "C√° ng·ª´" }, { question: "'Wasabi' ƒë∆∞·ª£c l√†m t·ª´ c√¢y g√¨?", options: ["C·∫£i ng·ª±a", "G·ª´ng", "B·∫°c h√†"], answer: "C·∫£i ng·ª±a" },]};

        // --- STYLESHEET ---
        const styles = {
            container: { fontFamily: 'sans-serif', maxWidth: '600px', margin: 'auto', display: 'flex', flexDirection: 'column', height: '100vh', backgroundColor: '#FFF5F7', boxShadow: '0 0 10px rgba(0,0,0,0.1)' },
            mainContent: { flex: 1, overflowY: 'auto' },
            screen: { padding: 16, display: 'flex', flexDirection: 'column' },
            header: { padding: '16px 0', textAlign: 'center' },
            headerTitle: { fontSize: 24, fontWeight: 'bold', color: '#5a3838' },
            headerSubtitle: { fontSize: 16, color: '#6B7280', marginTop: 4 },
            contentArea: { flex: 1, justifyContent: 'center', textAlign: 'center' },
            primaryButton: { backgroundColor: '#FF6B8A', padding: 16, borderRadius: 12, textAlign: 'center', marginTop: 20, border: 'none', cursor: 'pointer', color: 'white', fontSize: 18, fontWeight: 'bold' },
            backButton: { marginBottom: 16, cursor: 'pointer', border: 'none', background: 'none', textAlign: 'left', padding: 0 },
            backButtonText: { color: '#FF6B8A', fontSize: 16 },
            roadmapPathContainer: { padding: '20px', position: 'relative' },
            roadmapPathLine: { position: 'absolute', top: 0, bottom: 0, left: '28px', width: '4px', backgroundColor: '#FFD1DC', zIndex: 1 },
            milestoneContainer: { display: 'flex', alignItems: 'flex-start', marginBottom: 20, position: 'relative', zIndex: 2 },
            milestoneIconContainer: { minWidth: 40, height: 40, borderRadius: '50%', display: 'flex', justifyContent: 'center', alignItems: 'center', marginRight: 15, zIndex: 1, border: '3px solid white' },
            milestoneIconText: { color: '#FFF', fontWeight: 'bold', fontSize: 18, margin: 0 },
            milestoneCard: { flex: 1, borderWidth: 2, borderStyle: 'solid', borderRadius: 12, padding: 16, backgroundColor: '#FFF' },
            milestoneTitle: { fontSize: 18, fontWeight: 'bold', margin: 0 },
            milestoneDescription: { fontSize: 14, marginTop: 4, margin: 0 },
            startButtonText: { color: '#FFF', fontWeight: 'bold' },
            reviewButton: { border: 'none', background: 'none', cursor: 'pointer', width: '100%', textAlign: 'left', padding: 0, marginTop: 8},
            reviewButtonText: { color: '#10B981', fontWeight: 'bold' },
            quizScreen: { padding: 16, display: 'flex', flexDirection: 'column', height: '100%', boxSizing: 'border-box' },
            quizProgressText: { textAlign: 'center', fontSize: 16, fontWeight: 'bold', color: '#5a3838', marginBottom: 20 },
            quizQuestionText: { fontSize: 22, fontWeight: '600', textAlign: 'center', marginBottom: 30 },
            quizOptionButton: { width: '100%', textAlign: 'left', backgroundColor: '#FFF', padding: 16, borderRadius: 12, border: '2px solid #E5E7EB', marginBottom: 12, cursor: 'pointer' },
            correctAnswer: { backgroundColor: '#D1FAE5', borderColor: '#10B981' },
            incorrectAnswer: { backgroundColor: '#FEE2E2', borderColor: '#EF4444' },
            bottomNav: { display: 'flex', justifyContent: 'space-around', borderTop: '1px solid #E5E7EB', backgroundColor: '#FFF', padding: '8px 0' },
            navButton: { flex: 1, alignItems: 'center', border: 'none', background: 'none', cursor: 'pointer', padding: '4px 0' },
            navButtonText: { fontSize: 12, margin: 0, marginTop: 2 },
            practiceGrid: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16, padding: '0 16px' },
            practiceCard: { backgroundColor: '#FFF', borderRadius: 12, padding: 20, textAlign: 'center', border: '1px solid #E5E7EB', cursor: 'pointer', transition: 'transform 0.2s ease-in-out' },
            practiceCardTitle: { fontSize: 16, fontWeight: 'bold', color: '#5a3838', margin: 0 },
            practiceCardSubtitle: { fontSize: 12, color: '#6B7280', marginTop: 4, margin: 0 },
            challengeCard: { gridColumn: '1 / -1', background: 'linear-gradient(45deg, #FF6B8A, #FFB7C5)', color: 'white', padding: 20, borderRadius: 12, textAlign: 'center', cursor: 'pointer', transition: 'transform 0.2s ease-in-out' },
            challengeTitle: { fontSize: 20, fontWeight: 'bold', margin: 0},
            challengeSubtitle: { margin: '4px 0 0 0', opacity: 0.9 },
            leaderboardList: { padding: '0 16px' },
            leaderboardItem: { display: 'flex', alignItems: 'center', padding: '12px', backgroundColor: '#FFF', borderRadius: 12, marginBottom: 8 },
            leaderboardRank: { fontSize: 16, fontWeight: 'bold', color: '#6B7280', width: 40 },
            leaderboardAvatar: { width: 40, height: 40, borderRadius: '50%', marginRight: 12 },
            leaderboardName: { flex: 1, fontSize: 16, fontWeight: '500', color: '#374151' },
            leaderboardXp: { fontSize: 16, fontWeight: 'bold', color: '#FF6B8A' },
            currentUserItem: { backgroundColor: '#FFEDF1', borderWidth: 2, borderStyle: 'solid', borderColor: '#FF6B8A' },
            shopHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0 16px' },
            shopPoints: { backgroundColor: '#FFEDF1', color: '#FF6B8A', padding: '4px 12px', borderRadius: '99px', fontWeight: 'bold' },
            shopGrid: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16, padding: '16px' },
            shopItem: { backgroundColor: '#FFF', borderRadius: 12, padding: 16, textAlign: 'center', border: '1px solid #E5E7EB' },
            shopItemIcon: { fontSize: 40, margin: '10px 0' },
            shopItemName: { fontWeight: 'bold', color: '#5a3838' },
            shopItemPrice: { display: 'flex', justifyContent: 'center', alignItems: 'center', fontWeight: 'bold', color: '#FF6B8A', marginTop: 8 },
            buyButton: { width: '100%', marginTop: 12, backgroundColor: '#FF6B8A', border: 'none', color: 'white', padding: '8px', borderRadius: 8, cursor: 'pointer' },
            ownedButton: { width: '100%', marginTop: 12, backgroundColor: '#10B981', border: 'none', color: 'white', padding: '8px', borderRadius: 8, cursor: 'not-allowed' },
        };

        // --- C√ÅC COMPONENT GIAO DI·ªÜN ---
        const { useState, useEffect } = React;
        const Hoverable = ({ children, style }) => {const [hover, setHover] = useState(false); return (<div onMouseEnter={() => setHover(true)} onMouseLeave={() => setHover(false)} style={{...style, ...(hover ? {transform: 'scale(1.03)'} : {})}}>{children}</div>);};
        const Milestone = ({ milestone, state, onStart }) => { const isLocked = state === 'locked'; const isCompleted = state === 'completed'; const isCurrent = state === 'current'; const stateStylesDef = {completed: { iconBg: '#10B981', borderColor: '#10B981', textColor: '#065F46' }, current: { iconBg: '#FF6B8A', borderColor: '#FF6B8A', textColor: '#5a3838' }, locked: { iconBg: '#D1D5DB', borderColor: '#D1D5DB', textColor: '#9CA3AF' }}; const currentStyle = stateStylesDef[state]; return (<div style={styles.milestoneContainer}><div style={{...styles.milestoneIconContainer, backgroundColor: currentStyle.iconBg }}>{isCompleted && <p style={styles.milestoneIconText}>‚úì</p>}{isCurrent && <p style={styles.milestoneIconText}>‚ñ∂</p>}{isLocked && <p style={styles.milestoneIconText}>üîí</p>}</div><div style={{...styles.milestoneCard, borderColor: currentStyle.borderColor, backgroundColor: isLocked ? '#F9FAFB' : '#FFF' }}><p style={{...styles.milestoneTitle, color: currentStyle.textColor }}>{milestone.level} - {milestone.title}</p><p style={{...styles.milestoneDescription, color: isLocked ? '#9CA3AF' : '#6B7280' }}>{milestone.description}</p>{isCurrent && (<button style={{...styles.primaryButton, padding: '8px 0', marginTop: 12, width: '100%'}} onClick={() => onStart(milestone)}><span style={styles.startButtonText}>B·∫Øt ƒë·∫ßu</span></button>)}{isCompleted && (<button style={styles.reviewButton} onClick={() => onStart(milestone)}><span style={styles.reviewButtonText}>√în t·∫≠p</span></button>)}</div></div>);};
        const RoadmapScreen = ({ milestones, userProgress, onStartMilestone }) => ( <div style={styles.screen}><header style={styles.header}><h1 style={styles.headerTitle}>L·ªô tr√¨nh H·ªçc t·∫≠p</h1></header><div style={styles.roadmapPathContainer}><div style={styles.roadmapPathLine} />{milestones.map(milestone => {let state = 'locked'; if (userProgress.completedMilestones.includes(milestone.id)) state = 'completed'; else if (userProgress.currentMilestoneId === milestone.id) state = 'current'; return <Milestone key={milestone.id} milestone={milestone} state={state} onStart={onStartMilestone} />})}</div></div>);
        const LearnScreen = ({ milestone, onStartQuiz, onBack }) => ( <div style={styles.quizScreen}><button onClick={onBack} style={styles.backButton}><span style={styles.backButtonText}>&lt; Tr·ªü v·ªÅ</span></button><header style={styles.header}><h1 style={styles.headerTitle}>{milestone.title}</h1><p style={styles.headerSubtitle}>{milestone.description}</p></header><main style={styles.contentArea}><p>N·ªôi dung h·ªçc t·∫≠p s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y.</p></main><button style={styles.primaryButton} onClick={() => onStartQuiz(milestone)}>B·∫Øt ƒë·∫ßu Ki·ªÉm tra</button></div>);
        const QuizScreen = ({ quizData, onCompleteQuiz, onBack }) => { const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0); const [score, setScore] = useState(0); const [selectedAnswer, setSelectedAnswer] = useState(null); const [isCorrect, setIsCorrect] = useState(null); const question = quizData.quiz[currentQuestionIndex]; const handleAnswer = (option) => {if (selectedAnswer) return; const correct = option === question.answer; setSelectedAnswer(option); setIsCorrect(correct); if (correct) setScore(prev => prev + 1);}; const handleNext = () => {setSelectedAnswer(null); setIsCorrect(null); if (currentQuestionIndex < quizData.quiz.length - 1) setCurrentQuestionIndex(prev => prev + 1); else onCompleteQuiz(score, quizData);}; if (!question || question.length === 0) { return <div style={styles.quizScreen}><button onClick={onBack} style={styles.backButton}><span style={styles.backButtonText}>&lt; Tr·ªü v·ªÅ</span></button><main style={styles.contentArea}><p>Ch∆∞a c√≥ c√¢u h·ªèi cho c·ªôt m·ªëc n√†y.</p></main></div>} return (<div style={styles.quizScreen}><button onClick={onBack} style={styles.backButton}><span style={styles.backButtonText}>&lt; Tr·ªü v·ªÅ</span></button><p style={styles.quizProgressText}>{`C√¢u ${currentQuestionIndex + 1} / ${quizData.quiz.length}`}</p><main style={styles.contentArea}><h2 style={styles.quizQuestionText}>{question.question}</h2><div>{question.options.map(option => {let buttonStyle = {...styles.quizOptionButton}; if (selectedAnswer === option) buttonStyle = {...buttonStyle, ...(isCorrect ? styles.correctAnswer : styles.incorrectAnswer)}; else if (selectedAnswer && question.answer === option) buttonStyle = {...buttonStyle, ...styles.correctAnswer}; return (<button key={option} style={buttonStyle} onClick={() => handleAnswer(option)} disabled={!!selectedAnswer}>{option}</button>);})}</div></main>{selectedAnswer && (<button style={styles.primaryButton} onClick={handleNext}>{currentQuestionIndex < quizData.quiz.length - 1 ? 'C√¢u ti·∫øp theo' : 'Ho√†n th√†nh'}</button>)}</div>);};
        const PracticeScreen = ({ onStartChallenge }) => ( <div style={styles.screen}><header style={styles.header}><h1 style={styles.headerTitle}>Trung t√¢m Luy·ªán t·∫≠p</h1></header><div style={styles.practiceGrid}><Hoverable style={styles.challengeCard}><div onClick={onStartChallenge}><h3 style={styles.challengeTitle}>üî• Th·ª≠ th√°ch VƒÉn h√≥a</h3><p style={styles.challengeSubtitle}>Ki·ªÉm tra ki·∫øn th·ª©c v·ªÅ Nh·∫≠t B·∫£n!</p></div></Hoverable><Hoverable style={styles.practiceCard}><div onClick={() => alert('B·∫Øt ƒë·∫ßu luy·ªán T·ª´ v·ª±ng')}><p style={styles.practiceCardTitle}>Luy·ªán T·ª´ v·ª±ng</p><p style={styles.practiceCardSubtitle}>ƒê√£ thu·ªôc: 88/150</p></div></Hoverable><Hoverable style={styles.practiceCard}><div onClick={() => alert('B·∫Øt ƒë·∫ßu luy·ªán Ng·ªØ ph√°p')}><p style={styles.practiceCardTitle}>Luy·ªán Ng·ªØ ph√°p</p><p style={styles.practiceCardSubtitle}>Ho√†n th√†nh: 12/20</p></div></Hoverable></div></div>);
        const LeaderboardScreen = ({ leaderboardData, currentUser }) => ( <div style={styles.screen}><header style={styles.header}><h1 style={styles.headerTitle}>B·∫£ng x·∫øp h·∫°ng</h1></header><div style={styles.leaderboardList}>{leaderboardData.map((user, index) => (<div key={user.id} style={{...styles.leaderboardItem, ...(user.id === currentUser.id ? styles.currentUserItem : {})}}><span style={styles.leaderboardRank}>#{index + 1}</span><img src={user.avatarUrl} alt={user.displayName} style={styles.leaderboardAvatar} /><span style={styles.leaderboardName}>{user.displayName}</span><span style={styles.leaderboardXp}>{user.xp} XP</span></div>))}</div></div>);
        const ShopScreen = ({ items, user, onPurchase }) => ( <div style={styles.screen}><header style={{...styles.header, ...styles.shopHeader}}><h1 style={styles.headerTitle}>C·ª≠a h√†ng</h1><span style={styles.shopPoints}>üå∏ {user.sakuraPoints}</span></header><div style={styles.shopGrid}>{items.map(item => {const isOwned = user.purchasedItems.includes(item.id); const canAfford = user.sakuraPoints >= item.price; return (<div key={item.id} style={styles.shopItem}><div style={styles.shopItemIcon}>{item.icon}</div><p style={styles.shopItemName}>{item.name}</p><p style={styles.shopItemPrice}>üå∏ {item.price}</p>{isOwned ? (<button style={styles.ownedButton} disabled>ƒê√£ s·ªü h·ªØu</button>) : (<button style={{...styles.buyButton, opacity: canAfford ? 1 : 0.5}} disabled={!canAfford} onClick={() => onPurchase(item)}>Mua</button>)}</div>);})}</div></div>);
        const BottomNav = ({ activeTab, setActiveTab }) => {const NavButton = ({ tabName, label, icon }) => (<button onClick={() => setActiveTab(tabName)} style={styles.navButton}><span style={{color: activeTab === tabName ? '#FF6B8A' : '#6B7280', fontSize: 24}}>{icon}</span><p style={{...styles.navButtonText, color: activeTab === tabName ? '#FF6B8A' : '#6B7280', fontWeight: activeTab === tabName ? 'bold' : 'normal'}}>{label}</p></button>); return (<nav style={styles.bottomNav}><NavButton tabName="Roadmap" label="L·ªô tr√¨nh" icon="üó∫Ô∏è" /><NavButton tabName="Practice" label="Luy·ªán t·∫≠p" icon="üèãÔ∏è" /><NavButton tabName="Leaderboard" label="X·∫øp h·∫°ng" icon="üèÜ" /><NavButton tabName="Shop" label="C·ª≠a h√†ng" icon="üõçÔ∏è" /></nav>);};

        // --- COMPONENT APP CH√çNH ---
        function App() {
            const [isLoading, setIsLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('Roadmap');
            const [currentFlow, setCurrentFlow] = useState(null);
            const [milestones, setMilestones] = useState([]);
            const [userProgress, setUserProgress] = useState(null);
            const [leaderboard, setLeaderboard] = useState([]);
            const [shopItems, setShopItems] = useState([]);

            useEffect(() => {
                setMilestones(MOCK_MILESTONES);
                setUserProgress(MOCK_USER_PROGRESS);
                setLeaderboard(MOCK_LEADERBOARD_DATA);
                setShopItems(MOCK_SHOP_ITEMS);
                setIsLoading(false);
            }, []);

            const handleStartMilestone = (milestone) => setCurrentFlow({ screen: 'Learn', data: milestone });
            const handleStartQuiz = (milestone) => setCurrentFlow({ screen: 'Quiz', data: { ...milestone, type: 'milestone' } });
            const handleStartChallenge = () => setCurrentFlow({ screen: 'Quiz', data: { ...MOCK_CULTURAL_CHALLENGE, type: 'challenge' } });
            const handleBackToMain = () => setCurrentFlow(null);
            const handleCompleteQuiz = (score, quizData) => {
                alert(`B·∫°n ƒë√£ ho√†n th√†nh ${quizData.title} v√† tr·∫£ l·ªùi ƒë√∫ng ${score}/${quizData.quiz.length} c√¢u!`);
                setUserProgress(prev => ({...prev, xp: prev.xp + quizData.xpReward}));
                if (quizData.type === 'milestone') {
                    const nextMilestone = milestones.find(m => m.order === quizData.order + 1);
                    setUserProgress(prev => ({...prev, sakuraPoints: prev.sakuraPoints + quizData.sakuraPointReward, completedMilestones: [...prev.completedMilestones, quizData.id], currentMilestoneId: nextMilestone ? nextMilestone.id : null }));
                }
                handleBackToMain();
            };
            const handlePurchaseItem = (item) => {
                if (userProgress.sakuraPoints < item.price) {
                    alert("B·∫°n kh√¥ng ƒë·ªß ƒêi·ªÉm Sakura!");
                    return;
                }
                setUserProgress(prev => ({...prev, sakuraPoints: prev.sakuraPoints - item.price, purchasedItems: [...prev.purchasedItems, item.id],}));
                alert(`Ch√∫c m·ª´ng! B·∫°n ƒë√£ mua th√†nh c√¥ng ${item.name}.`);
            };

            if (isLoading) { return <p>ƒêang t·∫£i...</p>; }

            if (currentFlow) {
                switch (currentFlow.screen) {
                    case 'Learn': return <LearnScreen milestone={currentFlow.data} onStartQuiz={handleStartQuiz} onBack={handleBackToMain} />;
                    case 'Quiz': return <QuizScreen quizData={currentFlow.data} onCompleteQuiz={handleCompleteQuiz} onBack={handleBackToMain} />;
                    default: return null;
                }
            }
            return (
                <div style={styles.container}>
                    <main style={styles.mainContent}>
                        {activeTab === 'Roadmap' && <RoadmapScreen milestones={milestones} userProgress={userProgress} onStartMilestone={handleStartMilestone} />}
                        {activeTab === 'Practice' && <PracticeScreen onStartChallenge={handleStartChallenge} />}
                        {activeTab === 'Leaderboard' && <LeaderboardScreen leaderboardData={leaderboard} currentUser={userProgress} />}
                        {activeTab === 'Shop' && <ShopScreen items={shopItems} user={userProgress} onPurchase={handlePurchaseItem} />}
                    </main>
                    <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
